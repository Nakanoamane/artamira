# カラーピッカー機能の詳細設計

**実装状況**: 完了

この設計書では、「フロントエンドのコア機能設計」で「これから実装する内容」として挙げられているカラーピッカー機能について、より詳細な実装内容を定義します。

## 1. 使用ライブラリ

*   **`react-colorful`**: カラーピッカーのコア機能を提供します。軽量で、依存関係がなく、ツリーシェイク可能である点が選定理由です。様々なカラーモデルに対応しており、TypeScriptフレンドリーです。
*   **`tailwindcss`**: UIのスタイリングに利用します。

## 2. `ColorPicker.tsx` の実装内容

`src/components/ColorPicker.tsx` を以下のように改修します。

### コンポーネントの責務

*   ユーザーが選択した描画色を親コンポーネントに通知します。
*   カラーピッカー（色選択UI）の表示/非表示を管理します。ポップオーバー形式での表示を想定しています。
*   HEX形式のカラーコード入力欄を提供し、ユーザーが直接カラーコードを入力したり、ペーストしたりすることを可能にします。

### UI要素

*   **色見本表示**: 現在選択されている色を示す小さな四角形の要素を配置します。この要素をクリックすることでカラーピッカー本体が表示/非表示が切り替わります。
*   **カラーピッカー本体**: `react-colorful` ライブラリから提供される `HexColorPicker` を使用します。これにより、直感的な色選択インターフェースを提供します。
*   **HEXコード入力欄**: `react-colorful` ライブラリから提供される `HexColorInput` を使用し、選択された色のHEXコードをリアルタイムで表示し、ユーザーが手動でHEXコードを入力・編集できるようにします。
*   **透過（Alpha）スライダー**: `react-colorful` の `AlphaSlider` または同様のコンポーネントを使用し、色の透明度を調整できるスライダーを提供します。HEXA形式（例: `#RRGGBBAA`）に対応できるようにします。
*   **基本色選択ボタン**: よく使われる基本色（例：赤、青、緑、黄、黒、白など6〜12色程度）をボタンとして配置し、クリックするだけでその色を選択できるようにします。
*   **履歴色表示**: 直近で使用した色を3つ程度表示し、クリックすることで再度その色を選択できるようにします。
*   **閉じるボタン**: （任意）カラーピッカーのポップオーバーを明示的に閉じるためのボタンを設置する場合があります。

### 状態管理

*   `useState` Reactフックを利用して、以下の状態を管理します。
    *   `selectedColor`: 現在選択されている色（HEX形式の文字列、例: `#RRGGBB`）。
    *   `isPickerVisible`: カラーピッカーのポップオーバーが表示されているかどうかの真偽値。

### イベントハンドリング

*   **色見本要素のクリック**: `isPickerVisible` の状態をトグルし、カラーピッカーの表示/非表示を切り替えます。
*   **`HexColorPicker` の `onChange` イベント**: ユーザーがピッカーで色を選択するたびに発火し、`selectedColor` の状態を更新します。更新された色は、プロップスを通じて親コンポーネントにコールバック関数で通知されます。
*   **`HexColorInput` の `onChange` イベント**: ユーザーがHEXコード入力欄を操作するたびに発火し、`selectedColor` の状態を更新します。同様に、更新された色は親コンポーネントに通知されます。

## 3. 親コンポーネント (`Toolbar.tsx`) との連携

*   `ColorPicker.tsx` コンポーネントは、プロップスとして、親コンポーネントが管理する色情報を初期値として受け取り、色の変更があった場合にその変更を親コンポーネントに伝えるためのコールバック関数 (`onColorChange` など) を受け取ります。
*   親コンポーネント (`Toolbar.tsx` または `DrawingBoard.tsx`) は、`ColorPicker` から受け取った色情報を一元管理し、描画キャンバス (`Canvas.tsx`) にその色をプロップスとして渡すことで、描画色として利用できるようにします。

## 4. スタイリング

*   TailwindCSS を利用して、色見本、カラーピッカーのポップオーバー、HEXコード入力欄など、`ColorPicker` コンポーネントの各UI要素をデザインガイドラインに沿ってスタイリングします。
*   `react-colorful` は非常に軽量で、デフォルトのスタイルは最小限であるため、プロジェクトのUI/UX要件に合わせて詳細なカスタムスタイルを適用します。

## 5. 実装ステップ

1.  **`react-colorful` ライブラリのインストール**:
    ```bash
    npm install react-colorful
    ```
2.  **`src/components/ColorPicker.tsx` の新規作成または更新**:\
    *   `react-colorful` から `HexColorPicker` と `HexColorInput` をインポートします。
    *   `useState` フックを用いて、選択中の色 (`selectedColor`) とカラーピッカーの表示状態 (`isPickerVisible`) を管理します。
    *   色見本をクリックした際に `isPickerVisible` を切り替えるロジックを実装し、ポップオーバーの表示/非表示を制御します。\
    *   `HexColorPicker` および `HexColorInput` の `onChange` イベントハンドラを実装し、選択された色を親コンポーネントへ伝えるコールバック関数を呼び出します。\
    *   TailwindCSS クラスを適用して、UI要素のレイアウトとデザインを行います。
3.  **親コンポーネント (`Toolbar.tsx`) の更新**:\
    *   `ColorPicker` コンポーネントをインポートし、レンダリングします。\
    *   `ColorPicker` が選択した色を受け取るための状態を管理し、その色を `Canvas.tsx` に渡せるようにします。

## 6. 機能拡張

### 6.1 透過（Alpha）の選択

*   **目的**: ユーザーが描画色の透明度を調整できるようにします。
*   **実装内容**:
    *   `react-colorful` の `HexAlphaColorPicker` または `RgbaColorPicker` を使用し、アルファチャンネルに対応したカラーピッカーを導入します。
    *   必要に応じて、別途アルファ値を調整するためのスライダーコンポーネント (`react-colorful` の `AlphaSlider` など) を追加します。
    *   色の値はHEXA形式（例: `#RRGGBBAA`）またはRGBAオブジェクトで管理し、親コンポーネントへの通知もこれに対応させます。

### 6.2 基本色選択ボタン

*   **目的**: ユーザーが素早く基本色を選択できるように、プリセットされた色ボタンを提供します。
*   **実装内容**:
    *   `ColorPicker.tsx` 内に、固定のHEXカラーコードを持つボタンのリストを定義します。6〜12色程度が適切です。
    *   各ボタンをクリックすると、そのボタンの色が現在の選択色として設定され、親コンポーネントに通知されます。
    *   TailwindCSS を使用して、これらのボタンを整列させ、視覚的に分かりやすくスタイリングします。

### 6.3 履歴色表示機能

*   **目的**: ユーザーが最近使用した色を再利用できるように、履歴として表示します。
*   **実装内容**:
    *   `ColorPicker.tsx` の内部状態、または親コンポーネント (`Toolbar.tsx` / `DrawingBoard.tsx`) の状態として、最近選択された色を管理する配列 (`colorHistory`) を導入します。最大3つ程度の履歴を保持します。
    *   新しい色が選択されるたびに、`colorHistory` に色を追加し、古い色を削除するロジックを実装します。
    *   `colorHistory` の色を小さな色見本として表示し、クリックすることでその色が現在の選択色となるようにします。

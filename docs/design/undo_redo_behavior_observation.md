# Undo/Redo機能の挙動に関する観察と要件

## 1. 現状の挙動（問題点）

Undo/Redo機能において、以下のような問題が観察されています。

1.  **描画アクション**: ユーザーがキャンバスに何かを描画します。
2.  **最初のUndoボタン押下**:
    *   Undoボタンが押下される。
    *   しかし、直前の描画は**元に戻らない**。
    *   Undoボタンは**まだ押せる状態**のままである。
3.  **二度目のUndoボタン押下**:
    *   再度Undoボタンが押下される。
    *   ようやく最初の描画が元に戻る。
    *   Redoボタンが押せる状態になるが、Undoボタンはまだ押せる可能性がある。
4.  **Redoボタン押下**:
    *   Redoボタンが押下される。
    *   最初の描画が再描画される。
    *   しかし、**Redoボタンはまだ押せる状態**のままである。

この現象により、Undo/Redoの履歴管理とボタンの活性状態が正しく連携していないことが示唆されます。特に、アクションが2回送信または受信されている、あるいは状態更新が適切に行われていない可能性があります。

## 2. 期待される挙動

Undo/Redo機能は以下のように動作するべきです。

1.  **描画アクション**: ユーザーがキャンバスに何かを描画します。
2.  **Undoボタン押下**:
    *   Undoボタンが押下される。
    *   直前の描画が**元に戻る**。
    *   Undoボタンは**押せなくなる**（履歴がなくなる場合）。
    *   Redoボタンが押せる状態になる。
3.  **Redoボタン押下**:
    *   Redoボタンが押下される。
    *   元に戻された描画が**再描画される**。
    *   Redoボタンは**押せなくなる**（進む履歴がなくなる場合）。
    *   Undoボタンが押せる状態になる。

これにより、Undo/Redo操作が1回で完了し、ボタンの状態が履歴の有無に正しく連動するようになります。

---
